## Method for CAPs and HAPs for states is similar to CAP_HAP for national model
# but uses summary level target and stateio economic data for allocation
# allocation for fuel use is TBD
# Note that EPA_Nonpoint already used some state level allocations for ag-related
# emissions


!include:USEEIO_summary_target.yaml
target_sector_year: 2012
geoscale: state
_emission_year: &year 2020

sources_to_cache:
  EIA_MECS_Energy:
    !include:CAP_HAP_common.yaml:sources_to_cache:EIA_MECS_Energy_state
    year: 2018
    attribution_source:
      Employment_state_2018: # Update to MECS year
        geoscale: national
        year: 2018
    clean_source: Employment_state_2018

_attribution_sources:
  stateio: &stateio
    year: *year
    geoscale: state
    activity_to_sector_mapping: BEA_2012_Summary
    exclusion_fields:
      ActivityConsumedBy: ['F030', 'F040', 'F050', 'F051', 
                           'F02E', 'F06E', 'F07E', 'F10E']
    attribution_method: equal
    ## No attribution supplied (will use equal) because target level for
    ## modeling is BEA summary level.

source_names:
  EPA_NEI_Nonpoint:
    !include:CAP_HAP_common.yaml:source_names:EPA_NEI_Nonpoint
    year: *year

    # Update some activity sets from Common to use stateior instead of BEA
    activity_sets:
      !include:CAP_HAP_common.yaml:source_names:EPA_NEI_Nonpoint:activity_sets
      mobile_and_fuel_storage:
        selection_fields:
          PrimaryActivity: !from_index:NEI_Nonpoint_asets.csv mobile_and_fuel_storage
        attribution_method: proportional
        attribution_source:
          stateio_Use_Summary:
            <<: *stateio
            selection_fields:
              ActivityProducedBy: {'324': ''}  # Petroleum 324110

      fertilizers:
        selection_fields:
          PrimaryActivity: !from_index:NEI_Nonpoint_asets.csv fertilizers
        attribution_method: proportional
        attribution_source:
          stateio_Use_Summary:
            <<: *stateio
            selection_fields:
              ActivityProducedBy: {'325': ''}  # Fertilizers 325310

      pesticides:
        !include:CAP_HAP_common.yaml:source_names:EPA_NEI_Nonpoint:activity_sets:pesticides
        attribution_source:
          stateio_Use_Summary:
            <<: *stateio
            selection_fields:
              ActivityProducedBy: {'325': ''}  # Pesticides 325320

      output_allocation: # Gross Output
        selection_fields:
          PrimaryActivity: !from_index:NEI_Nonpoint_asets.csv output_allocation
        attribution_method: proportional
        attribution_source:
          stateio_Industry_GO:
            <<: *stateio
            selection_fields:
              Class: Money

  EPA_NEI_Nonroad:
    !include:CAP_HAP_common.yaml:source_names:EPA_NEI_Nonroad
    year: *year
    # Update some activity sets from Common to use stateior instead of BEA
    activity_sets:
      !include:CAP_HAP_common.yaml:source_names:EPA_NEI_Nonroad:activity_sets
      offroad_vehicles_equipment:
        selection_fields:
          PrimaryActivity: !from_index:NEI_Nonroad_asets.csv offroad_vehicles_equipment
        attribution_method: proportional
        attribution_source:
          stateio_Use_Summary:
            <<: *stateio
            selection_fields:
              ActivityProducedBy: {'324': ''}  # Petroleum 324110

  EPA_NEI_Onroad:
    !include:CAP_HAP_common.yaml:source_names:EPA_NEI_Onroad
    year: *year
    # Update some activity sets from Common to use stateior instead of BEA
    activity_sets:
      !include:CAP_HAP_common.yaml:source_names:EPA_NEI_Onroad:activity_sets
      onroad_vehicles_gas_stations:
        selection_fields:
          PrimaryActivity: !from_index:NEI_Onroad_asets.csv onroad_vehicles_gas_stations
        attribution_method: proportional
        attribution_source:
          stateio_Use_Summary:
            <<: *stateio
            selection_fields:
              ActivityProducedBy: {'324': ''}  # Petroleum 324110

  stewiFBS:
    !include:CAP_HAP_common.yaml:source_names:stewiFBS
    inventory_dict:
      NEI: *year
      TRI: *year
    local_inventory_name: NEI_TRI_air_2020
