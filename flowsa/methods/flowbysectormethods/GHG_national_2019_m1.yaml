# m1 for the GHG national replicates the method used in the National GHG
# Industry Attribution Model (https://doi.org/10.23719/1517571), except that
# sector attribution is to 6-digit NAICS, rather than the BEA 2012 IO schema

# Differences from 2016 method are 1) source year, 2) replace A-9 with A-6
# (2019)

target_sector_level: NAICS_6
target_sector_source: NAICS_2012_Code
target_geoscale: national
source_names:
  "EPA_GHGI_T_2_1": #U.S. GHG emissions
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_2_1
    year: &ghgi_year 2019
    activity_sets: # Update USGS year for these activity_sets
      !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_2_1:activity_sets
      lead:
        !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_2_1:activity_sets:lead
        allocation_source_year: *ghgi_year
  "EPA_GHGI_T_3_68": #CH4 from Natural Gas Systems
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_68
    year: *ghgi_year
  "EPA_GHGI_T_3_70": #CO2 from Natural Gas Systems mimics CH4
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_70
    year: *ghgi_year
  "EPA_GHGI_T_3_72":  #N2O from Natural Gas Systems, not used in original method, mimics CH4
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_72
    year: *ghgi_year
  "EPA_GHGI_T_3_42": #CH4 from Petroleum Systems
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_42
    year: *ghgi_year
  "EPA_GHGI_T_3_44": #CO2 from Petroleum Systems mimics CH4
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_44
    year: *ghgi_year
  "EPA_GHGI_T_3_46": #N2O from Petroleum Systems mimics CH4
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_46
    year: *ghgi_year
  "EPA_GHGI_T_5_28": #CH4, N2O, CO and NOx from field burning of residues
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_5_28
    year: *ghgi_year
  "EPA_GHGI_T_5_3": #CH4 from Enteric Fermentation
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_5_3
    year: *ghgi_year
  "EPA_GHGI_T_5_6": #CH4 and N2O from manure, mimics enteric fermentation
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_5_6
    year: *ghgi_year
  "EPA_GHGI_T_5_17": #Direct N2O emissions from agricultural soils
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_5_17
    year: *ghgi_year
  "EPA_GHGI_T_5_18": #Indirect N2O emissions from agricultural soils
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_5_18
    year: *ghgi_year
  # "EPA_GHGI_T_3_13": #C02 from mobile combustion
  #   !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_13
  #   year: *ghgi_year
  "EPA_GHGI_T_3_14": #CH4 from mobile combustion
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_14
    year: *ghgi_year
  "EPA_GHGI_T_3_15": #N2O from mobile combustion duplicates method for CH4
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_15
    year: *ghgi_year
  "EPA_GHGI_T_4_46": #CO2 for selected petrochemicals
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_4_46
    year: *ghgi_year
  "EPA_GHGI_T_4_50": # HFCs from HCFC-22 production
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_4_50
    year: *ghgi_year
  "EPA_GHGI_T_4_96": # HFCs and other emissions from electronics manufacture
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_4_96
    year: *ghgi_year
  "EPA_GHGI_T_4_102": # HFCs and PFCs from ODS Substitutes
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_4_102
    year: *ghgi_year
  "EPA_GHGI_T_A_97": # HFCs from Transportation
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_A_97
    year: *ghgi_year
  "EPA_GHGI_T_4_80": # PFCs from aluminum production
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_4_80
    year: *ghgi_year
  "EPA_GHGI_T_4_86": # HFCs, SF6, CO2 from magnesium production
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_4_86
    year: *ghgi_year
  "EPA_GHGI_T_3_22b": #Fossil fuel for non-energy uses
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_22b
    year: *ghgi_year
    activity_sets: # Update EIA_MECS year for some activity_sets
      !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_22b:activity_sets
      petroleum:
        !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_22b:activity_sets:petroleum
        allocation_source_year: 2018
        helper_source_year: 2018
      natural_gas:
        !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_22b:activity_sets:natural_gas
        allocation_source_year: 2018
        helper_source_year: 2018

## Major CO2 Sources
  "EPA_GHGI_T_A_6":  # CO2 emissions from stationary combustion and transportation
    data_format: 'FBA'
    class: Chemicals
    geoscale_to_use: national
    year: 2019 # Table A_6 is specific to 2019
    clean_fba_df_fxn: !script_function:EPA_GHGI allocate_industrial_combustion
    fedefl_mapping: 'GHGI'
    activity_sets:
      direct: #direct allocation
        names:
            - "Total (All Fuels) Residential"
        allocation_method: direct
        allocation_source: None
        allocation_from_scale: national
      coal: &use_allocation # Coal
        names:
            - "Commercial Coal Commercial"
            - "Industrial Other Coal Industrial"
        allocation_method: proportional
        allocation_source: "BEA_Use_Detail_PRO_BeforeRedef"
        activity_to_sector_mapping: "BEA_2012_Detail"
        allocation_source_class: "Money"
        allocation_source_year: 2012
        allocation_flow:
          - "USD2012"
        allocation_compartment: None
        allocation_from_scale: national
        clean_allocation_fba: !script_function:BEA subset_BEA_table
        clean_parameter: {"212100": 'ActivityProducedBy'} # purchases of coal
        helper_source: "BLS_QCEW"
        helper_method: proportional
        helper_source_class: "Employment"
        helper_source_year: 2012
        helper_flow: None
        helper_from_scale: national
        clean_helper_fba_wsec: !script_function:BLS_QCEW bls_clean_allocation_fba_w_sec
      natural_gas: # Natural Gas
        <<: *use_allocation
        names:
            - "Natural Gas Commercial"
            - "Natural Gas Industrial"
        clean_parameter: {"221200": 'ActivityProducedBy'} # purchases of natural gas
      petroleum: # Petroleum
        <<: *use_allocation
        names:
            - "Total Petroleum Commercial"
            - "Total Petroleum Industrial"
        clean_parameter: {"324110": 'ActivityProducedBy'} # purchases of refinery
      coal_manufacturing: &fuel_MECS # Industrial Coal for Manufacturing
        names:
            - "Industrial Other Coal Industrial - Manufacturing"
        allocation_method: proportional
        allocation_source: "EIA_MECS_Energy"
        allocation_source_class: "Energy" # fuel consumption
        allocation_source_year: 2018
        allocation_flow:
            - "Coal"
        allocation_compartment: None
        allocation_from_scale: national
        allocation_selection_fields:
            Description:
                - "Table 2.2"  # Nonfuel (class Other)
                - "Table 3.2"  # Fuel (class Energy)
        clean_allocation_fba: !script_function:EIA_MECS mecs_energy_fba_cleanup
        clean_allocation_fba_w_sec: !script_function:EIA_MECS eia_mecs_energy_clean_allocation_fba_w_sec
        helper_source: "BLS_QCEW"
        helper_method: proportional-flagged
        helper_source_class: "Employment"
        helper_source_year: 2018
        helper_flow: None
        helper_from_scale: national
        clean_helper_fba_wsec: !script_function:BLS_QCEW bls_clean_allocation_fba_w_sec
      natural_gas_manufacturing: # Industrial Natural Gas for manufacturing
        <<: *fuel_MECS
        names:
            - "Natural Gas Industrial - Manufacturing"
        allocation_flow:
            - "Natural Gas"
    ### Transportation
      ng_transport: &transport_direct
        names:
            - "Natural Gas Transportation"
        allocation_method: proportional
        allocation_source: "EPA_GHGI_T_A_73"
        allocation_source_class: "Energy"
        allocation_source_year: *ghgi_year
        allocation_flow: ['Natural Gas']
        allocation_compartment: None
        allocation_from_scale: national
        helper_source: "BLS_QCEW"
        helper_method: proportional
        helper_source_class: "Employment"
        helper_source_year: *ghgi_year
        helper_flow: None
        helper_from_scale: national
        clean_helper_fba_wsec: !script_function:BLS_QCEW bls_clean_allocation_fba_w_sec
      aviation_transport:
        <<: *transport_direct
        names:
            - "Aviation Gasoline Transportation"
        allocation_flow: ['Aviation Gasoline']
      jet_transport:
        <<: *transport_direct
        names:
            - "Jet Fuel Transportation"
        allocation_flow: ['Jet Fuel']
      lpg_transport:
        <<: *transport_direct
        names:
            - "LPG (Propane) Transportation"
        allocation_flow: ['LPG']
      rfo_transport:
        <<: *transport_direct
        names:
            - "Residual Fuel Transportation"
      dfo_transport: &transport_use
        names:
            - "Distillate Fuel Oil Transportation"
        allocation_method: proportional
        allocation_source: "EPA_GHGI_T_A_73"
        allocation_source_class: "Energy"
        allocation_source_year: *ghgi_year
        allocation_flow: ['Distillate Fuel Oil']
        allocation_compartment: None
        allocation_from_scale: national
        clean_allocation_fba: !script_function:EPA_GHGI adjust_transport_activities
        clean_allocation_fba_w_sec: !script_function:EPA_GHGI keep_six_digit_naics
        helper_source: "BEA_Use_Detail_PRO_BeforeRedef"
        helper_activity_to_sector_mapping: "BEA_2012_Detail"
        helper_method: proportional
        helper_source_class: "Money"
        helper_source_year: 2012
        helper_flow: ["USD2012"]
        helper_from_scale: national
        clean_helper_fba_wsec: !script_function:BEA subset_and_allocate_BEA_table
        clean_parameter: {"324110": 'ActivityProducedBy'} # use of petroleum products
      gasoline_transport:
        <<: *transport_use
        names:
            - "Motor Gasoline Transportation"
        allocation_flow: ['Motor Gasoline']

  "EPA_GHGI_T_3_8": # CH4 emissions from stationary combustion
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_8
    year: *ghgi_year
    activity_sets:
      !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_8:activity_sets
      coal_manufacturing:
        <<: *fuel_MECS
        names:
            - "Coal Industrial - Manufacturing"
        allocation_flow:
            - "Coal"
      ng_manufacturing: # Industrial
        <<: *fuel_MECS
        names:
            - "Natural Gas Industrial - Manufacturing"
        allocation_flow:
            - "Natural Gas"

  "EPA_GHGI_T_3_9": # N2O emissions from stationary combustion
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_9
    year: *ghgi_year
    activity_sets:
      !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_9:activity_sets
      coal_manufacturing:
        <<: *fuel_MECS
        names:
            - "Coal Industrial - Manufacturing"
        allocation_flow:
            - "Coal"
      ng_manufacturing: # Industrial
        <<: *fuel_MECS
        names:
            - "Natural Gas Industrial - Manufacturing"
        allocation_flow:
            - "Natural Gas"
