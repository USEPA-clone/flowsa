# m1 for the GHG national replicates the method used in the National GHG
# Industry Attribution Model (https://doi.org/10.23719/1517571), except that
# sector attribution is to 6-digit NAICS, rather than the BEA 2012 IO schema

# Differences from 2016 method are 1) source year, 2) replace A-14 with A-11
# (2019), 3) replace 3-22b with 3-22 (2019 data only)

target_sector_level: NAICS_6
target_sector_source: NAICS_2012_Code
target_geoscale: national
source_names:
  "EPA_GHGI_T_2_1": #U.S. GHG emissions
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_2_1
    year: &ghgi_year 2019
  "EPA_GHGI_T_3_63": #CH4 from Natural Gas Systems
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_63
    year: *ghgi_year
  "EPA_GHGI_T_3_65": #CO2 from Natural Gas Systems mimics CH4
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_65
    year: *ghgi_year
  "EPA_GHGI_T_3_67":  #N2O from Natural Gas Systems, not used in original method, mimics CH4
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_67
    year: *ghgi_year
  "EPA_GHGI_T_3_38": #CH4 from Petroleum Systems
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_38
    year: *ghgi_year
  "EPA_GHGI_T_3_40": #CO2 from Petroleum Systems mimics CH4
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_40
    year: *ghgi_year
  "EPA_GHGI_T_3_42": #N2O from Petroleum Systems mimics CH4
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_42
    year: *ghgi_year
  "EPA_GHGI_T_5_29": #CH4, N2O, CO and NOx from field burning of residues
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_5_29
    year: *ghgi_year
  "EPA_GHGI_T_5_3": #CH4 from Enteric Fermentation
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_5_3
    year: *ghgi_year
  "EPA_GHGI_T_5_7": #CH4 and N2O from manure, mimics enteric fermentation
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_5_7
    year: *ghgi_year
  "EPA_GHGI_T_5_18": #Direct N2O emissions from agricultural soils
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_5_18
    year: *ghgi_year
  "EPA_GHGI_T_5_19": #Indirect N2O emissions from agricultural soils
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_5_19
    year: *ghgi_year
  "EPA_GHGI_T_3_14": #CH4 from mobile combustion
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_14
    year: *ghgi_year
  "EPA_GHGI_T_3_15": #N2O from mobile combustion duplicates method for CH4
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_15
    year: *ghgi_year
  "EPA_GHGI_T_4_46": #CO2 for selected petrochemicals
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_4_46
    year: *ghgi_year
  "EPA_GHGI_T_4_50": # HFCs from HCFC-22 production
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_4_50
    year: *ghgi_year
  "EPA_GHGI_T_4_94": # HFCs and other emissions from electronics manufacture
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_4_94
    year: *ghgi_year
  "EPA_GHGI_T_4_101": # HFCs and PFCs from ODS Substitutes
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_4_101
    year: *ghgi_year
  "EPA_GHGI_T_A_103": # HFCs from Transportation
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_A_103
    year: *ghgi_year
  "EPA_GHGI_T_4_80": # PFCs from aluminum production
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_4_80
    year: *ghgi_year
  "EPA_GHGI_T_4_84": # HFCs, SF6, CO2 from magnesium production
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_4_84
    year: *ghgi_year

## Major CO2 Sources
  "EPA_GHGI_T_A_11":  # CO2 emissions from stationary combustion and transportation
    data_format: 'FBA'
    class: Chemicals
    geoscale_to_use: national
    year: 2019 # Table A_11 is specific to 2019
    clean_fba_df_fxn: !script_function:EPA_GHGI allocate_industrial_combustion
    fedefl_mapping: 'GHGI'
    activity_sets:
      activity_set_1: #direct allocation
        names:
            - "Total (All Fuels) Residential"
        allocation_method: direct
        allocation_source: None
        allocation_from_scale: national
      activity_set_2: &use_allocation # Coal
        names:
            - "Commercial Coal Commercial"
            - "Industrial Other Coal Industrial"
        allocation_method: proportional
        allocation_source: "BEA_Use_Detail_PRO_BeforeRedef"
        activity_to_sector_mapping: "BEA_2012_Detail"
        allocation_source_class: "Money"
        allocation_source_year: 2012
        allocation_flow:
          - "USD2012"
        allocation_compartment: None
        allocation_from_scale: national
        clean_allocation_fba: !script_function:BEA subset_BEA_table
        clean_parameter: {"212100": 'ActivityProducedBy'} # purchases of coal
        helper_source: "BLS_QCEW"
        helper_method: proportional
        helper_source_class: "Employment"
        helper_source_year: 2012
        helper_flow: None
        helper_from_scale: national
        clean_helper_fba_wsec: !script_function:BLS_QCEW bls_clean_allocation_fba_w_sec
      activity_set_3: # Natural Gas
        <<: *use_allocation
        names:
            - "Natural Gas Commercial"
            - "Natural Gas Industrial"
        clean_parameter: {"221200": 'ActivityProducedBy'} # purchases of natural gas
      activity_set_4: # Petroleum
        <<: *use_allocation
        names:
            - "Total Petroleum Commercial"
            - "Total Petroleum Industrial"
        clean_parameter: {"324110": 'ActivityProducedBy'} # purchases of refinery
      activity_set_5: &fuel_MECS # Industrial Coal for Manufacturing
        names:
            - "Industrial Other Coal Industrial - Manufacturing"
        allocation_method: proportional
        allocation_source: "EIA_MECS_Energy"
        allocation_source_class: "Energy" # fuel consumption
        allocation_source_year: 2018
        allocation_flow:
            - "Coal"
        allocation_compartment: None
        allocation_from_scale: national
        allocation_selection_fields:
            Description:
                - "Table 2.2"  # Nonfuel (class Other)
                - "Table 3.2"  # Fuel (class Energy)
        clean_allocation_fba: !script_function:EIA_MECS mecs_energy_fba_cleanup
        clean_allocation_fba_w_sec: !script_function:EIA_MECS eia_mecs_energy_clean_allocation_fba_w_sec
        helper_source: "BLS_QCEW"
        helper_method: proportional-flagged
        helper_source_class: "Employment"
        helper_source_year: 2018
        helper_flow: None
        helper_from_scale: national
        clean_helper_fba_wsec: !script_function:BLS_QCEW bls_clean_allocation_fba_w_sec
      activity_set_6: # Industrial Natural Gas for manufacturing
        <<: *fuel_MECS
        names:
            - "Natural Gas Industrial - Manufacturing"
        allocation_flow:
            - "Natural Gas"
    ### Transportation
      activity_set_7: &transport_direct
        names:
            - "Natural Gas Transportation"
        allocation_method: proportional
        allocation_source: "EPA_GHGI_T_A_79"
        allocation_source_class: "Energy"
        allocation_source_year: *ghgi_year
        allocation_flow: ['Natural Gas']
        allocation_compartment: None
        allocation_from_scale: national
        helper_source: "BLS_QCEW"
        helper_method: proportional
        helper_source_class: "Employment"
        helper_source_year: *ghgi_year
        helper_flow: None
        helper_from_scale: national
        clean_helper_fba_wsec: !script_function:BLS_QCEW bls_clean_allocation_fba_w_sec
      activity_set_8:
        <<: *transport_direct
        names:
            - "Aviation Gasoline Transportation"
        allocation_flow: ['Aviation Gasoline']
      activity_set_9:
        <<: *transport_direct
        names:
            - "Jet Fuel Transportation"
        allocation_flow: ['Jet Fuel']
      activity_set_10:
        <<: *transport_direct
        names:
            - "LPG (Propane) Transportation"
        allocation_flow: ['LPG']
      activity_set_11:
        <<: *transport_direct
        names:
            - "Residual Fuel Transportation"
        allocation_flow: ['Residual Fuel Oil']
      activity_set_12: &transport_use
        names:
            - "Distillate Fuel Oil Transportation"
        allocation_method: proportional
        allocation_source: "EPA_GHGI_T_A_79"
        allocation_source_class: "Energy"
        allocation_source_year: *ghgi_year
        allocation_flow: ['Distillate Fuel Oil (Diesel Fuel)']
        allocation_compartment: None
        allocation_from_scale: national
        clean_allocation_fba: !script_function:EPA_GHGI adjust_transport_activities
        clean_allocation_fba_w_sec: !script_function:EPA_GHGI keep_six_digit_naics
        helper_source: "BEA_Use_Detail_PRO_BeforeRedef"
        helper_activity_to_sector_mapping: "BEA_2012_Detail"
        helper_method: proportional
        helper_source_class: "Money"
        helper_source_year: 2012
        helper_flow: ["USD2012"]
        helper_from_scale: national
        clean_helper_fba_wsec: !script_function:BEA subset_and_allocate_BEA_table
        clean_parameter: {"324110": 'ActivityProducedBy'} # use of petroleum products
      activity_set_13:
        <<: *transport_use
        names:
            - "Motor Gasoline Transportation"
        allocation_flow: ['Motor Gasoline']

  "EPA_GHGI_T_3_8": # CH4 emissions from stationary combustion
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_8
    year: *ghgi_year
    activity_sets:
      !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_8:activity_sets
      activity_set_6:
        <<: *fuel_MECS
        names:
            - "Coal Industrial - Manufacturing"
        allocation_flow:
            - "Coal"
      activity_set_7: # Industrial
        <<: *fuel_MECS
        names:
            - "Natural gas Industrial - Manufacturing"
        allocation_flow:
            - "Natural Gas"

  "EPA_GHGI_T_3_9": # N2O emissions from stationary combustion
    !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_9
    year: *ghgi_year
    activity_sets:
      !include:GHG_national_2016_m1.yaml:source_names:EPA_GHGI_T_3_9:activity_sets
      activity_set_6:
        <<: *fuel_MECS
        names:
            - "Coal Industrial - Manufacturing"
        allocation_flow:
            - "Coal"
      activity_set_7: # Industrial
        <<: *fuel_MECS
        names:
            - "Natural gas Industrial - Manufacturing"
        allocation_flow:
            - "Natural Gas"

  "EPA_GHGI_T_3_22": #Fossil fuel for non-energy uses
      data_format: 'FBA'
      class: Chemicals
      geoscale_to_use: national
      year: *ghgi_year
      fedefl_mapping: 'GHGI'
      activity_sets:
        activity_set_1:  #this set is direct for coal products
          names:
            - "Industry Industrial Coking Coal"
            - "Industry Industrial Other Coal"
          allocation_method: direct
          allocation_from_scale: national
        activity_set_2: # consumed petroleum products
          <<: *fuel_MECS
          names:
            - "Industry Asphalt & Road Oil"
            - "Industry Distillate Fuel Oil"
            - "Industry LPG"
            - "Industry Lubricants"
            - "Industry Miscellaneous Products"
            - "Industry Naphtha (<401 F)"
            - "Industry Other Oil (>401 F)"
            - "Industry Pentanes Plus"
            - "Industry Petroleum Coke"
            - "Industry Special Naphtha"
            - "Industry Still Gas"
            - "Industry Waxes"
          allocation_source: "EIA_MECS_Energy"
          allocation_source_class: "Other" # nonfuel consumption
          allocation_flow:
            - "Other" # consistent with original, but other flows may be better
        activity_set_3: # consumed nat gas to chemical plants
          <<: *fuel_MECS
          names:
            - "Industry Natural Gas to Chemical Plants"
          allocation_source: "EIA_MECS_Energy"
          allocation_source_class: "Other" # nonfuel consumption
          allocation_flow:
            - "Natural Gas"
        activity_set_4:
          <<: *use_allocation
          names:
            - "Transportation Lubricants"
          clean_parameter: {"324110": 'ActivityProducedBy'} # purchases of refinery
