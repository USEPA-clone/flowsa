## Method for CAPs and HAPs for states is similar to CAP_HAP for national model
# but uses summary level target and stateio economic data for allocation
# allocation for fuel use is TBD
# Note that EPA_Nonpoint already used some state level allocations for ag-related
# emissions


!include:USEEIO_summary_target.yaml
target_naics_year: 2012
geoscale: state
_emission_year: &year 2017

sources_to_cache:
  EIA_MECS_Energy:
    year: 2018
    geoscale: state
    selection_fields:
      Class: Energy
      Unit: Trillion Btu
      Description:
          - Table 2.2
          - Table 3.2
    exclusion_fields:
      Location: '00000'
    estimate_suppressed: !script_function:EIA_MECS estimate_suppressed_mecs_energy
    clean_fba: !script_function:EIA_MECS clean_mecs_energy_fba
    clean_fba_w_sec: !script_function:EIA_MECS clean_mapped_mecs_energy_fba_to_state
    attribution_method: proportional
    attribution_source:
      Employment_state_2018:
        data_format: FBS
        geoscale: state
        year: 2018

_attribution_sources:
  stateio: &stateio
    year: 2012
    geoscale: state
    activity_to_sector_mapping: BEA_2012_Summary
    attribution_method: proportional
    attribution_source:
      Employment_state_2012:
        data_format: FBS
        geoscale: state
        year: 2012

source_names:
  EPA_NEI_Nonpoint:
    !include:CAP_HAP_common.yaml:source_names:EPA_NEI_Nonpoint
    year: *year

    # Update some activity sets from Common to use stateior instead of BEA
    activity_sets:
      !include:CAP_HAP_common.yaml:source_names:EPA_NEI_Nonpoint:activity_sets
      mobile_and_fuel_storage:
        selection_fields:
          PrimaryActivity: !from_index:NEI_Nonpoint_asets.csv mobile_and_fuel_storage
        attribution_method: proportional
        attribution_source:
          stateio_Use_Summary:
            <<: *stateio
            selection_fields:
              ActivityProducedBy: {'324': ''}  # Petroleum 324110

      fertilizers:
        selection_fields:
          PrimaryActivity: !from_index:NEI_Nonpoint_asets.csv fertilizers
        attribution_method: proportional
        attribution_source:
          stateio_Use_Summary:
            <<: *stateio
            selection_fields:
              ActivityProducedBy: {'325': ''}  # Fertilizers 325310

      pesticides:
        selection_fields:
          PrimaryActivity: !from_index:NEI_Nonpoint_asets.csv pesticides
        exclusion_fields:
        # To avoid overlap with other datasets, emissions of pesticides
        # from pesticide application are removed.
          FlowName:
            - 2,4-Dichlorophenoxy Acetic Acid
            - Captan
            - Carbaryl
            - Methyl Bromide
            - Methyl Iodide
            - Parathion
            - Trifluralin
        attribution_method: proportional
        attribution_source:
          stateio_Use_Summary:
            <<: *stateio
            selection_fields:
              ActivityProducedBy: {'325': ''}  # Pesticides 325320

      output_allocation: # Gross Output
        selection_fields:
          PrimaryActivity: !from_index:NEI_Nonpoint_asets.csv output_allocation
        attribution_method: proportional
        attribution_source:
          stateio_Industry_GO:
            year: 2017
            geoscale: state
            activity_to_sector_mapping: BEA_2012_Summary
            selection_fields:
              Class: Money
              FlowName: USD2017
            attribution_method: proportional
            attribution_source:
              Employment_state_2017:
                data_format: FBS
                geoscale: state
                year: 2017

  EPA_NEI_Nonroad:
    !include:CAP_HAP_common.yaml:source_names:EPA_NEI_Nonroad
    year: *year
    # Update some activity sets from Common to use stateior instead of BEA
    activity_sets:
      !include:CAP_HAP_common.yaml:source_names:EPA_NEI_Nonroad:activity_sets
      offroad_vehicles_equipment:
        selection_fields:
          PrimaryActivity: !from_index:NEI_Nonroad_asets.csv offroad_vehicles_equipment
        attribution_method: proportional
        attribution_source:
          stateio_Use_Summary:
            <<: *stateio
            selection_fields:
              ActivityProducedBy: {'324': ''}  # Petroleum 324110

  EPA_NEI_Onroad:
    !include:CAP_HAP_common.yaml:source_names:EPA_NEI_Onroad
    year: *year
    # Update some activity sets from Common to use stateior instead of BEA
    activity_sets:
      !include:CAP_HAP_common.yaml:source_names:EPA_NEI_Onroad:activity_sets
      onroad_vehicles_gas_stations:
        selection_fields:
          PrimaryActivity: !from_index:NEI_Onroad_asets.csv onroad_vehicles_gas_stations
        attribution_method: proportional
        attribution_source:
          stateio_Use_Summary:
            <<: *stateio
            selection_fields:
              ActivityProducedBy: {'324': ''}  # Petroleum 324110


  stewiFBS: !include:stewiFBS_common.yaml:CAP_HAP
    inventory_dict:
      NEI: *year
      TRI: *year
    local_inventory_name: NEI_TRI_air_2017
