# GHG 2016 refac for attribution_disaggregation
industry_spec:
  default: NAICS_6
target_naics_year: 2012
geoscale: national

source_names:
  EPA_GHGI_T_3_8: # CH4 emissions from stationary combustion
    year: 2018
    clean_fba_before_activity_sets: !script_function:EPA_GHGI allocate_industrial_combustion
    clean_parameter:
        energy_fba: 'EIA_MECS_Energy'
        year: 2018
        ghg_fba: 'EPA_GHGI_T_A_7' # 2018 Table
    fedefl_mapping: GHGI
    activity_sets:
      ng_manufacturing:
        selection_fields:
          PrimaryActivity:
            - Natural gas Industrial - Manufacturing
            - Natural Gas Industrial - Manufacturing
        disaggregate:
          crosswalk:
            NAICS_Crosswalk_EPA_GHGI:
              merge_keys:
                left_on: ActivityProducedBy # FBA column
                right_on: Activity # Crosswalk column
              add_columns:
                SectorProducedBy: Sector # New column from crosswalk

            !script_function:naics explode:
              column: SectorProducedBy
              merge_keys:
                'on': SectorProducedBy
              add_columns:
                SectorProducedBy: target_naics
            ## ^^ explode the GHG crosswalk (which only shows mappings to 31, 32, 33)
          drop_columns: ActivityConsumedBy # FBA column not needed
          attribution_method: proportional
          source:
            EIA_MECS_Energy:
              year: 2018
              selection_fields:
                Class: Energy # or Other (for non-energy use)
                Unit: Trillion Btu
                FlowName: Natural Gas
                Location: '00000'
                Description:
                  - Table 2.2 # applies to Class Other
                  - Table 3.2 # applies to Class Energy
              estimate_suppressed: !script_function:EIA_MECS estimate_suppressed_mecs_energy
              clean_fba: !script_function:EIA_MECS clean_mecs_energy_fba
              clean_fba_w_sec: !script_function:EIA_MECS clean_mapped_mecs_energy_fba
              merge_keys:
                left_on: SectorProducedBy
                right_on: SectorConsumedBy
              disaggregate:
                crosswalk:
                  !script_function:naics explode:
                    column: ActivityConsumedBy
                    merge_keys:
                      'on': ActivityConsumedBy
                    add_columns:
                      SectorConsumedBy: target_naics
                ## ^^ no crosswalk specified (already NAICS based - but need to explode)
                drop_columns: ActivityProducedBy # FBA column not needed
                attribution_method: proportional
                source:
                  BEA_Use_Detail_PRO_BeforeRedef:
                    year: 2012
                    selection_fields:
                      ActivityProducedBy: {'221200': ''} # Natural gas
                    merge_keys:
                      'on': SectorConsumedBy
                    disaggregate:
                      crosswalk:
                        NAICS_Crosswalk_BEA_2012_Detail:
                          merge_keys:
                            left_on: ActivityConsumedBy # FBA column
                            right_on: Activity # Crosswalk column
                          add_columns:
                            SectorConsumedBy: Sector # New column from crosswalk
                      drop_columns: ActivityProducedBy # FBA column not needed
                      attribution_method: equal


