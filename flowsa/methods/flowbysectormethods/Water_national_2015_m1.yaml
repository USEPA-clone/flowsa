# Attribute USGS NWIS water withdrawal to sectors.

industry_spec:
  default: NAICS_6
year: 2015
target_naics_year: 2012
geoscale: national

sources_to_cache:
  USDA_IWMS:
    industry_spec:
      default: NAICS_6
      NAICS_7: ['111150', '111199', '111940'] # hay and haylage set to NAICS7 - will update to NAICS6
    geoscale: state
    year: 2018
    selection_fields:
      Class: Water
    attribute:
      - attribution_method: inheritance
        clean_fba_after_attribution: !clean_function:flowbyclean substitute_nonexistent_values
        clean_source:
          USDA_IWMS:
            geoscale: national
            year: 2018
            selection_fields:
              Class: Water
            attribute:
              attribution_method: inheritance
      - attribution_method: direct
        clean_fba_after_attribution: !clean_function:flowbyclean weighted_average
        replacement_dictionary: {'HAY & HAYLAGE, (EXCL ALFALFA)': 'HAY & HAYLAGE',
                                  'HAY & HAYLAGE, ALFALFA': 'HAY & HAYLAGE',
                                 '111940A': '111940',
                                 '111940B': '111940'}
        clean_source:
          USDA_IWMS:
            year: 2018
            selection_fields:
              Class: Land
              PrimaryActivity: ['HAY & HAYLAGE, (EXCL ALFALFA)', 'HAY & HAYLAGE, ALFALFA']

source_names:
  "USGS_NWIS_WU":
    fedefl_mapping: USGS_NWIS_WU
    geoscale: state
    clean_fba_before_activity_sets: !script_function:USGS_NWIS_WU usgs_fba_data_cleanup
    activity_sets:
      direct_attribution:
        selection_fields:
          PrimaryActivity:
          - "Aquaculture"
          - "Irrigation Golf Courses"
          - "Public Supply"
          - "Thermoelectric Power"
          - "Domestic"
        attribute:
          attribution_method: direct
      employment_attribution:
        selection_fields:
          PrimaryActivity:
          - "Industrial"
          - "Mining"
        attribute:
          attribution_method: proportional
          attribution_source:
            Employment_national_2015:
              geoscale: national
              data_format: FBS
              year: 2015
      cropland_attribution:
        industry_spec:
          default: NAICS_6
          NAICS_7: ['111150', '111199']
        selection_fields:
          PrimaryActivity:
            - "Irrigation Crop"
        attribute:
          attribution_method: proportional
          attribution_source:
            USDA_CoA_Cropland:
              year: 2017
              selection_fields:
                Class: "Land"
                FlowName:
                  - "AREA HARVESTED, IRRIGATED"
                  - "AREA IN PRODUCTION, IRRIGATED"
                  - "AREA, IRRIGATED"
                  - 'AREA BEARING & NON-BEARING, IRRIGATED'
                  - 'AREA GROWN, IRRIGATED'
              activity_sets:
                cropland_attribution-pastureland:
                  selection_fields:
                    PrimaryActivity: 'AG LAND, (EXCL HARVESTED CROPLAND)'
                  attribute:
                    - attribution_method: proportional
                      attribution_source:
                        USDA_CoA_Cropland_NAICS:
                          year: 2017
                          selection_fields:
                            Class: Land
                            FlowName:
                              - "FARM OPERATIONS"
                          estimate_suppressed: !script_function:temp_data_source_functions estimate_suppressed_sectors_equal_attribution
                          selection_fields_after_data_suppression_estimation:
                            PrimaryActivity: ["112111", "112112", "11212", "1122",
                                              "11231", "11232", "11233", "11234",
                                              "11239", "11241", "11242", "11291",
                                              "11292", "11293", "11299"]
                    - attribution_method: multiplication
                      attribution_source: USDA_IWMS
                cropland_attribution-cropland:
                  selection_fields:
                    PrimaryActivity: ['SOYBEANS', 'CANOLA', 'FLAXSEED',
                      'MUSTARD, SEED', 'RAPESEED', 'SAFFLOWER', 'SESAME',
                      'SUNFLOWER', 'CAMELINA', 'BEANS, DRY EDIBLE, (EXCL LIMA),
                      INCL CHICKPEAS', 'BEANS, DRY EDIBLE, (EXCL CHICKPEAS &
                      LIMA)', 'BEANS, DRY EDIBLE, LIMA', 'CHICKPEAS', 'LENTILS',
                      'PEAS, DRY EDIBLE', 'PEAS, DRY, SOUTHERN (COWPEAS)',
                      'WHEAT', 'CORN', 'CORN, GRAIN', 'CORN, SILAGE',
                      'POPCORN, SHELLED', 'RICE', 'BARLEY', 'BUCKWHEAT',
                      'MILLET, PROSO', 'OATS', 'RYE', 'SORGHUM, GRAIN',
                      'SORGHUM, SILAGE', 'SORGHUM, SYRUP', 'TRITICALE', 'WILD
                      RICE', 'VEGETABLE TOTALS', 'BERRY TOTALS', 'CUT
                      CHRISTMAS TREES', 'SHORT TERM WOODY CROPS', 'TOBACCO',
                      'COTTON', 'SUGARCANE, SUGAR', 'SUGARCANE, SEED', 'HAY
                      & HAYLAGE', 'SUGARBEETS', 'SUGARBEETS, SEED',
                      'PEANUTS', 'GRASSES & LEGUMES TOTALS, SEED', 'HERBS,
                      DRY', 'HOPS', 'MINT, OIL', 'MISCANTHUS', 'MINT, TEA
                      LEAVES', 'FIELD CROPS, OTHER']
                  attribute:
                    - attribution_method: proportional
                      attribution_source:
                        USDA_CoA_Cropland_NAICS:
                          year: 2017
                          selection_fields:
                            Class: Land
                            FlowName:
                              - "AG LAND, CROPLAND, HARVESTED"
                            PrimaryActivity: ["11111", "11112", "11113", "11114",
                                              "11115", "11116", "11119", "111211",
                                              "111219", "11131",
                                              "11132", "111331", "111332",
                                              "111333", "111334", "111335",
                                              "111336", "111339", "11141",
                                              "111421", "111422", "11191", "11192",
                                              "11193", "11194", "11199"]
                          estimate_suppressed: !script_function:temp_data_source_functions estimate_suppressed_sectors_equal_attribution
                    - attribution_method: multiplication
                      attribution_source: USDA_IWMS
                cropland_attribution-orchards:
                  selection_fields:
                    PrimaryActivity: ORCHARDS
                  attribute:
                    # first directly attribute so orchards are equally attributed to related sectors
                    - attribution_method: direct
                    - attribution_method: multiplication
                      attribution_source: USDA_IWMS
      livestock_attribution:
        industry_spec:
          default: NAICS_6
          NAICS_7: ['112130', '112320', '112390', '112910',
                    '112920', '112930', '112990']
        selection_fields:
          PrimaryActivity:
            - "Livestock"
        attribute:
          attribution_method: proportional
          attribution_source:
            USDA_CoA_Livestock:
              year: 2017
              selection_fields:
                Class: Other
                FlowName:
                  - "HEAD"
                  - "NUMBER"
                  - "COLONIES"
                Compartment:
                  - "NOT SPECIFIED"
              attribute:
                attribution_method: multiplication
                attribution_source:
                  USGS_WU_Coef:
                    year: 2005
                    geoscale: national
                    attribute:
                      attribution_method: direct
