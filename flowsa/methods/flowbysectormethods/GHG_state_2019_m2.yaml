


!include:USEEIO_summary_target.yaml
year: &ghg_year 2019
mecs_year: &mecs_year 2018
geoscale: state


source_names:
## Directly sourced from State Inventory
  EPA_StateGHGI:
    geoscale: state
    year: *ghg_year
    fedefl_mapping: GHGI
    activity_sets:
      electricity_transmission: #SF6
      # replicates electricity_transmission from EPA_GHGI_T_2_1
        selection_fields:
          PrimaryActivity: !from_index:EPA_StateGHGI_asets.csv electricity_transmission
        attribution_method: direct
      petrochemicals: #CO2 for selected petrochemicals
      # replicates EPA_GHGI_T_4_46
        selection_fields:
          PrimaryActivity: !from_index:EPA_StateGHGI_asets.csv petrochemicals
        attribution_method: direct
      ag_livestock: #CH4 from Enteric Fermentation, CH4, N2O from manure
      # replicates EPA_GHGI_T_5_3 and EPA_GHGI_T_5_6
        selection_fields:
          PrimaryActivity: !from_index:EPA_StateGHGI_asets.csv ag_livestock
        attribution_method: direct
      ag_burning: #CH4, N2O, CO and NOx from field burning of residue
      # replicates EPA_GHGI_T_5_28
        selection_fields:
          PrimaryActivity: !from_index:EPA_StateGHGI_asets.csv ag_burning
        attribution_method: direct
      hcfc: # HFCs from HCFC-22 production
      # replicates EPA_GHGI_T_4_50
        selection_fields:
          PrimaryActivity: !from_index:EPA_StateGHGI_asets.csv hcfc
        attribution_method: direct


  EPA_GHGI_T_2_1: #U.S. GHG emissions
    year: *ghg_year
    fedefl_mapping: GHGI
    geoscale: national
    activity_sets:
      direct:
        ## TODO review these for possible direct attribution from StateGHGI
        !include:GHG_national_m1_common.yaml:source_names:EPA_GHGI_T_2_1:activity_sets:direct
        attribute:
          - attribution_method: direct
          - attribution_method: proportional
            attribute_on: ['Flowable', 'SectorProducedBy']
            fill_columns: Location
            attribution_source:
              EPA_StateGHGI:
                geoscale: state
                fedefl_mapping: GHGI
                selection_fields:
                  PrimaryActivity: !from_index:EPA_StateGHGI_asets.csv direct

      electric_power:
        !include:GHG_national_m1_common.yaml:source_names:EPA_GHGI_T_2_1:activity_sets:electric_power
        attribute:
          - attribution_method: proportional
            attribution_source:
              !include:GHG_national_m1_common.yaml:source_names:EPA_GHGI_T_2_1:activity_sets:electric_power:attribution_source
          - attribution_method: proportional
            attribute_on: ['Flowable', 'SectorProducedBy']
            fill_columns: Location
            attribution_source:
              EPA_StateGHGI:
                geoscale: state
                fedefl_mapping: GHGI
                selection_fields:
                  PrimaryActivity: !from_index:EPA_StateGHGI_asets.csv electric_power

      liming:
        !include:GHG_national_m1_common.yaml:source_names:EPA_GHGI_T_2_1:activity_sets:liming
        attribute:
          - attribution_method: proportional
            attribution_source:
              !include:GHG_national_m1_common.yaml:source_names:EPA_GHGI_T_2_1:activity_sets:liming:attribution_source
          - attribution_method: proportional
            attribute_on: ['Flowable', 'SectorProducedBy']
            fill_columns: Location
            attribution_source:
              EPA_StateGHGI:
                geoscale: state
                fedefl_mapping: GHGI
                selection_fields:
                  PrimaryActivity: !from_index:EPA_StateGHGI_asets.csv liming

      urea:
        !include:GHG_national_m1_common.yaml:source_names:EPA_GHGI_T_2_1:activity_sets:urea
        attribute:
          - attribution_method: proportional
            attribution_source:
              !include:GHG_national_m1_common.yaml:source_names:EPA_GHGI_T_2_1:activity_sets:urea:attribution_source
          - attribution_method: proportional
            attribute_on: ['Flowable', 'SectorProducedBy']
            fill_columns: Location
            attribution_source:
              EPA_StateGHGI:
                geoscale: state
                fedefl_mapping: GHGI
                selection_fields:
                  PrimaryActivity: !from_index:EPA_StateGHGI_asets.csv urea

      carbonate_use:
        !include:GHG_national_m1_common.yaml:source_names:EPA_GHGI_T_2_1:activity_sets:carbonate_use
        attribute:
          - attribution_method: proportional
            attribution_source:
              !include:GHG_national_m1_common.yaml:source_names:EPA_GHGI_T_2_1:activity_sets:carbonate_use:attribution_source
          - attribution_method: proportional
            attribute_on: ['Flowable', 'SectorProducedBy']
            fill_columns: Location
            attribution_source:
              EPA_StateGHGI:
                geoscale: state
                fedefl_mapping: GHGI
                selection_fields:
                  PrimaryActivity: !from_index:EPA_StateGHGI_asets.csv carbonate_use

      lead:
        !include:GHG_national_m1_common.yaml:source_names:EPA_GHGI_T_2_1:activity_sets:lead
        attribute:
          - attribution_method: proportional
            attribution_source:
              !include:GHG_national_m1_common.yaml:source_names:EPA_GHGI_T_2_1:activity_sets:lead:attribution_source
          - attribution_method: proportional
            attribute_on: ['Flowable', 'SectorProducedBy']
            fill_columns: Location
            attribution_source:
              EPA_StateGHGI:
                geoscale: state
                fedefl_mapping: GHGI
                selection_fields:
                  PrimaryActivity: !from_index:EPA_StateGHGI_asets.csv lead

      nitrous_oxide_use:
        !include:GHG_national_m1_common.yaml:source_names:EPA_GHGI_T_2_1:activity_sets:nitrous_oxide_use
        attribute:
          - attribution_method: proportional
            attribution_source:
              !include:GHG_national_m1_common.yaml:source_names:EPA_GHGI_T_2_1:activity_sets:nitrous_oxide_use:attribution_source
          - attribution_method: proportional
            attribute_on: ['Flowable', 'SectorProducedBy']
            fill_columns: Location
            attribution_source:
              EPA_StateGHGI:
                geoscale: state
                fedefl_mapping: GHGI
                selection_fields:
                  PrimaryActivity: !from_index:EPA_StateGHGI_asets.csv nitrous_oxide_use

## Fossil Fuels
  EPA_GHGI_T_3_68: &natgas #CH4 from Natural Gas Systems
    !include:GHG_national_m1_common.yaml:source_names:EPA_GHGI_T_3_68
    year: *ghg_year
    geoscale: national
    attribute:
      - attribution_method: direct
      - attribution_method: proportional
        attribute_on: ['Flowable', 'SectorProducedBy']
        fill_columns: Location
        attribution_source:
          EPA_StateGHGI:
            geoscale: state
            fedefl_mapping: GHGI
            selection_fields:
              PrimaryActivity: !from_index:EPA_StateGHGI_asets.csv ng_systems
  EPA_GHGI_T_3_70: *natgas #CO2 from Natural Gas Systems, mimics CH4
  EPA_GHGI_T_3_72: *natgas #N2O from Natural Gas Systems, mimics CH4


  EPA_GHGI_T_3_42: &petroleum #CH4 from Petroleum Systems
    !include:GHG_national_m1_common.yaml:source_names:EPA_GHGI_T_3_42
    year: *ghg_year
    geoscale: national
    attribute:
      - attribution_method: direct
      - attribution_method: proportional
        attribute_on: ['Flowable', 'SectorProducedBy']
        fill_columns: Location
        attribution_source:
          EPA_StateGHGI:
            geoscale: state
            fedefl_mapping: GHGI
            selection_fields:
              PrimaryActivity: !from_index:EPA_StateGHGI_asets.csv pet_systems
  EPA_GHGI_T_3_44: *petroleum #CO2 from Petroleum Systems, mimics CH4
  EPA_GHGI_T_3_46: *petroleum #N2O from Petroleum Systems, mimics CH4

## Agriculture
  EPA_GHGI_T_5_17: #Direct N2O emissions from agricultural soils
    year: *ghg_year
    geoscale: national
    fedefl_mapping: GHGI
    activity_sets:
      fertilizer_use: &fertilizer # allocated based on fertilizer use
        !include:GHG_national_m1_common.yaml:source_names:EPA_GHGI_T_5_17:activity_sets:fertilizer_use
        attribute:
          - attribution_method: proportional
            attribution_source:
              !include:GHG_national_m1_common.yaml:source_names:EPA_GHGI_T_5_17:activity_sets:fertilizer_use:attribution_source
          - attribution_method: proportional
            attribute_on: ['Flowable', 'SectorProducedBy']
            fill_columns: Location
            attribution_source:
              EPA_StateGHGI:
                geoscale: state
                fedefl_mapping: GHGI
                selection_fields:
                  PrimaryActivity: !from_index:EPA_StateGHGI_asets.csv n2o_soil_direct

## Mobile Sources
  EPA_GHGI_T_3_13: #CO2 from mobile combustion
    year: *ghg_year
    geoscale: national
    fedefl_mapping: GHGI
    activity_sets:
      direct_petroleum:
        !include:GHG_national_m1_common.yaml:source_names:EPA_GHGI_T_3_13:activity_sets:direct_petroleum
        attribute:
          - attribution_method: direct
          - attribution_method: proportional
            attribute_on: ['Flowable', 'SectorProducedBy']
            fill_columns: Location
            attribution_source:
              EPA_StateGHGI:
                geoscale: state
                fedefl_mapping: GHGI
                selection_fields:
                  PrimaryActivity: !from_index:EPA_StateGHGI_asets.csv transport_petroleum
      direct_ng:
        !include:GHG_national_m1_common.yaml:source_names:EPA_GHGI_T_3_13:activity_sets:direct_ng
        attribute:
          - attribution_method: direct
          - attribution_method: proportional
            attribute_on: ['Flowable', 'SectorProducedBy']
            fill_columns: Location
            attribution_source:
              EPA_StateGHGI:
                geoscale: state
                fedefl_mapping: GHGI
                selection_fields:
                  PrimaryActivity: !from_index:EPA_StateGHGI_asets.csv transport_ng

      petroleum_fuels:
        !include:GHG_national_m1_common.yaml:source_names:EPA_GHGI_T_3_13:activity_sets:petroleum_fuels
        attribute:
          - attribution_method: proportional
            attribution_source:
              !include:GHG_national_m1_common.yaml:source_names:EPA_GHGI_T_3_13:activity_sets:petroleum_fuels:attribution_source
          - attribution_method: proportional
            attribute_on: ['Flowable', 'SectorProducedBy']
            fill_columns: Location
            attribution_source:
              EPA_StateGHGI:
                geoscale: state
                fedefl_mapping: GHGI
                selection_fields:
                  PrimaryActivity: !from_index:EPA_StateGHGI_asets.csv transport_petroleum

## Stationary Combustion
  EPA_GHGI_T_A_6: # CO2 emissions from stationary combustion
    year: *ghg_year
    geoscale: national
    fedefl_mapping: GHGI
    clean_fba_before_activity_sets: !script_function:EPA_GHGI allocate_industrial_combustion
    clean_parameter: # Override each year for use in allocate_industrial_combustion
        energy_fba: 'EIA_MECS_Energy'
        year: *mecs_year
        ghg_fba: 'EPA_GHGI_T_A_7' # 2018 Table
    activity_sets:
      direct_attribution: #direct allocation
        !include:GHG_national_m1_common.yaml:source_names:GHGI_CO2_stationary_combustion_and_transport:activity_sets:direct_attribution
        attribute:
          - attribution_method: direct
          - attribution_method: proportional
            attribute_on: ['Flowable', 'SectorProducedBy']
            fill_columns: Location
            attribution_source:
              EPA_StateGHGI:
                geoscale: state
                fedefl_mapping: GHGI
                selection_fields:
                  PrimaryActivity: !from_index:EPA_StateGHGI_asets.csv residential_co2

      non-manufacturing_coal:
        !include:GHG_national_m1_common.yaml:source_names:GHGI_CO2_stationary_combustion_and_transport:activity_sets:non-manufacturing_coal
        attribute:
          - attribution_method: proportional
            attribution_source:
              !include:GHG_national_m1_common.yaml:source_names:GHGI_CO2_stationary_combustion_and_transport:activity_sets:non-manufacturing_coal:attribution_source
          - attribution_method: proportional
            attribute_on: ['Flowable', 'SectorProducedBy']
            fill_columns: Location
            attribution_source:
              EPA_StateGHGI:
                geoscale: state
                fedefl_mapping: GHGI
                selection_fields:
                  PrimaryActivity: !from_index:EPA_StateGHGI_asets.csv use_table_coal

      non-manufacturing_natural_gas: # Applies to non-manufacturing sectors like ag and mining
        !include:GHG_national_m1_common.yaml:source_names:GHGI_CO2_stationary_combustion_and_transport:activity_sets:non-manufacturing_natural_gas
        attribute:
          - attribution_method: proportional
            attribution_source:
              !include:GHG_national_m1_common.yaml:source_names:GHGI_CO2_stationary_combustion_and_transport:activity_sets:non-manufacturing_natural_gas:attribution_source
          - attribution_method: proportional
            attribute_on: ['Flowable', 'SectorProducedBy']
            fill_columns: Location
            attribution_source:
              EPA_StateGHGI:
                geoscale: state
                fedefl_mapping: GHGI
                selection_fields:
                  PrimaryActivity: !from_index:EPA_StateGHGI_asets.csv use_table_gas

      coal_manufacturing: # Industrial Coal for Manufacturing
        !include:GHG_national_m1_common.yaml:source_names:GHGI_CO2_stationary_combustion_and_transport:activity_sets:coal_manufacturing
        attribute:
          - attribution_method: proportional
            attribution_source:
              EIA_MECS_Energy:
                !include:GHG_national_m1_common.yaml:source_names:GHGI_CO2_stationary_combustion_and_transport:activity_sets:coal_manufacturing:attribution_source:EIA_MECS_Energy
                  year: *mecs_year
          - attribution_method: proportional
            attribute_on: ['Flowable', 'SectorProducedBy']
            fill_columns: Location
            attribution_source:
              EPA_StateGHGI:
                geoscale: state
                fedefl_mapping: GHGI
                selection_fields:
                  PrimaryActivity: !from_index:EPA_StateGHGI_asets.csv use_table_coal

      natural_gas_manufacturing: # Industrial Natural Gas for manufacturing
        !include:GHG_national_m1_common.yaml:source_names:GHGI_CO2_stationary_combustion_and_transport:activity_sets:natural_gas_manufacturing
        attribute:
          - attribution_method: proportional
            attribution_source:
              EIA_MECS_Energy:
                !include:GHG_national_m1_common.yaml:source_names:GHGI_CO2_stationary_combustion_and_transport:activity_sets:natural_gas_manufacturing:attribution_source:EIA_MECS_Energy
                  year: *mecs_year
          - attribution_method: proportional
            attribute_on: ['Flowable', 'SectorProducedBy']
            fill_columns: Location
            attribution_source:
              EPA_StateGHGI:
                geoscale: state
                fedefl_mapping: GHGI
                selection_fields:
                  PrimaryActivity: !from_index:EPA_StateGHGI_asets.csv use_table_gas


      petroleum: # Petroleum
        !include:GHG_national_m1_common.yaml:source_names:GHGI_CO2_stationary_combustion_and_transport:activity_sets:petroleum
        attribute:
          - attribution_method: proportional
            attribution_source:
              !include:GHG_national_m1_common.yaml:source_names:GHGI_CO2_stationary_combustion_and_transport:activity_sets:petroleum:attribution_source
          - attribution_method: proportional
            attribute_on: ['Flowable', 'SectorProducedBy']
            fill_columns: Location
            attribution_source:
              EPA_StateGHGI:
                geoscale: state
                fedefl_mapping: GHGI
                selection_fields:
                  PrimaryActivity: !from_index:EPA_StateGHGI_asets.csv use_table_pet



